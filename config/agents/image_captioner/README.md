# Image Captioner Agent

å›¾åƒæè¿°ç”Ÿæˆ Agentï¼ŒåŸºäº VLM (Vision Language Model) åˆ†æå›¾åƒå†…å®¹å¹¶ç”Ÿæˆè¯¦ç»†æè¿°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“¸ **å›¾åƒåˆ†æ**ï¼šè‡ªåŠ¨è¯†åˆ«å›¾åƒä¸­çš„ç‰©ä½“ã€åœºæ™¯å’Œç»†èŠ‚
- ğŸ“ **ç»“æ„åŒ–è¾“å‡º**ï¼šç”Ÿæˆç®€çŸ­æè¿°ã€è¯¦ç»†æè¿°ã€ç‰©ä½“åˆ—è¡¨å’Œåœºæ™¯ç±»å‹
- ğŸ¯ **è‡ªå®šä¹‰é—®é¢˜**ï¼šæ”¯æŒé’ˆå¯¹å›¾åƒæå‡ºç‰¹å®šé—®é¢˜
- ğŸŒ **å¤šæ¥æºæ”¯æŒ**ï¼šæ”¯æŒæœ¬åœ°å›¾åƒæ–‡ä»¶å’Œç½‘ç»œå›¾ç‰‡ URL

## è¾“å‡ºæ ¼å¼

```json
{
  "caption": "å›¾åƒçš„ç®€çŸ­æè¿°ï¼ˆ1-2å¥è¯ï¼‰",
  "details": "å›¾åƒçš„è¯¦ç»†æè¿°ï¼ŒåŒ…æ‹¬åœºæ™¯ã€äººç‰©ã€åŠ¨ä½œã€æ°›å›´ç­‰",
  "objects": ["ä¸»è¦ç‰©ä½“1", "ä¸»è¦ç‰©ä½“2", "ä¸»è¦ç‰©ä½“3"],
  "scene": "åœºæ™¯ç±»å‹ï¼ˆå¦‚ï¼šå®¤å†…/å®¤å¤–ã€åŸå¸‚/è‡ªç„¶ã€ç™½å¤©/å¤œæ™šç­‰ï¼‰"
}
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨ä¾¿æ·è„šæœ¬

```bash
# åŸºç¡€ç”¨æ³•ï¼ˆé»˜è®¤é—®é¢˜ï¼š"è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹"ï¼‰
./scripts/image_captioner.sh photo.jpg

# è‡ªå®šä¹‰é—®é¢˜
./scripts/image_captioner.sh photo.jpg "å›¾ç‰‡ä¸­æœ‰å“ªäº›åŠ¨ç‰©ï¼Ÿ"
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ CLI å‘½ä»¤

```bash
# æœ¬åœ°å›¾åƒæ–‡ä»¶
python src/main.py run image_captioner \
  --image photo.jpg \
  -i '{"question": "è¯·æè¿°è¿™å¼ å›¾ç‰‡"}'

# ç½‘ç»œå›¾ç‰‡ URL
python src/main.py run image_captioner \
  --image https://example.com/photo.jpg \
  -i '{"question": "è¯·æè¿°è¿™å¼ å›¾ç‰‡"}'

# å¤šå¼ å›¾ç‰‡
python src/main.py run image_captioner \
  --image photo1.jpg \
  --image photo2.jpg \
  -i '{"question": "è¯·æ¯”è¾ƒè¿™ä¸¤å¼ å›¾ç‰‡"}'

# ä» YAML æ–‡ä»¶è¯»å–é—®é¢˜
python src/main.py run image_captioner \
  --image photo.jpg \
  -i example_input.yaml

# æŒ‡å®šè¾“å‡ºæ ¼å¼
python src/main.py run image_captioner \
  --image photo.jpg \
  -i '{"question": "è¯·æè¿°è¿™å¼ å›¾ç‰‡"}' \
  --format md \
  -o description.md
```

## ç¤ºä¾‹

### è¾“å…¥
- å›¾åƒï¼šä¸€å¼ çŒ«å’ªååœ¨çª—å°ä¸Šçš„ç…§ç‰‡
- é—®é¢˜ï¼š`è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡`

### è¾“å‡º
```json
{
  "caption": "ä¸€åªæ©™è‰²çš„çŒ«å’ªååœ¨çª—å°ä¸Šï¼Œé€è¿‡ç»ç’ƒæœ›å‘çª—å¤–ã€‚",
  "details": "è¿™æ˜¯ä¸€å¼ å®¤å†…æ‹æ‘„çš„ç…§ç‰‡ã€‚ä¸€åªæ¯›è‰²é²œè‰³çš„æ©™è‰²è™æ–‘çŒ«ååœ¨çª—å°ä¸Šï¼Œèº«ä½“å‘ˆä¾§é¢å§¿æ€ï¼Œå¤´éƒ¨è½¬å‘çª—å¤–ã€‚çª—æˆ·æ˜¯ç™½è‰²æ¡†æ¶ï¼Œé€è¿‡ç»ç’ƒå¯ä»¥çœ‹åˆ°æ¨¡ç³Šçš„æˆ·å¤–æ™¯è‰²ã€‚çŒ«å’ªçš„è¡¨æƒ…ä¸“æ³¨ï¼Œä¼¼ä¹åœ¨è§‚å¯Ÿçª—å¤–çš„åŠ¨é™ã€‚æ•´ä½“å…‰çº¿æŸ”å’Œï¼Œè¥é€ å‡ºå®é™æ¸©é¦¨çš„æ°›å›´ã€‚",
  "objects": ["æ©™è‰²çŒ«å’ª", "çª—å°", "ç»ç’ƒçª—", "ç™½è‰²çª—æ¡†", "çª—å¸˜"],
  "scene": "å®¤å†…ï¼Œç™½å¤©ï¼Œæ¸©é¦¨å®¶å±…ç¯å¢ƒ"
}
```

## é…ç½®è¯´æ˜

### Agent é…ç½®
- **ç±»å‹**ï¼šVLM (Vision Language Model)
- **æ¨¡å‹**ï¼šqwen_vlï¼ˆå¯åœ¨ config.yaml ä¸­ä¿®æ”¹ï¼‰
- **è¾“å…¥å­—æ®µ**ï¼š
  - `question`ï¼šç”¨æˆ·çš„é—®é¢˜æˆ–æè¿°éœ€æ±‚
- **è¾“å‡ºå­—æ®µ**ï¼š
  - `caption`ï¼šç®€çŸ­æè¿°
  - `details`ï¼šè¯¦ç»†æè¿°
  - `objects`ï¼šç‰©ä½“åˆ—è¡¨
  - `scene`ï¼šåœºæ™¯ç±»å‹

### æ¨¡å‹è¦æ±‚
- éœ€è¦ä½¿ç”¨æ”¯æŒå›¾åƒè¾“å…¥çš„ VLM æ¨¡å‹
- ç¡®ä¿ `qwen_vl` æ¨¡å‹åœ¨ config.yaml ä¸­æ­£ç¡®é…ç½®ä¸” `enabled: true`
- è®¾ç½®ç›¸åº”çš„ API Key å’Œ API Base

## å¸¸è§é—®é¢˜

### Q: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ
A: æ”¯æŒå¸¸è§çš„å›¾ç‰‡æ ¼å¼ï¼šJPG, JPEG, PNG, GIF, BMP, WebP ç­‰ã€‚

### Q: å›¾ç‰‡å¤ªå¤§ä¼šæ€æ ·ï¼Ÿ
A: ç³»ç»Ÿä¼šè‡ªåŠ¨å‹ç¼©å¤§å›¾ç‰‡ã€‚å¯ä»¥åœ¨ config.yaml ä¸­é…ç½®ï¼š
```yaml
models:
  qwen_vl:
    resize_image_for_api: true
    max_image_size: 2048  # æœ€å¤§å°ºå¯¸ï¼ˆåƒç´ ï¼‰
    image_quality: 85     # JPEG å‹ç¼©è´¨é‡
```

### Q: å¯ä»¥åŒæ—¶åˆ†æå¤šå¼ å›¾ç‰‡å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½¿ç”¨å¤šä¸ª `--image` å‚æ•°ï¼Œæ¨¡å‹ä¼šç»¼åˆåˆ†ææ‰€æœ‰å›¾ç‰‡ã€‚

### Q: è¾“å‡ºæ ¼å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ
A:
- ä¸æŒ‡å®š `--format`ï¼šç³»ç»Ÿæ ¹æ®è¾“å‡ºå†…å®¹è‡ªåŠ¨é€‰æ‹©ï¼ˆé€šå¸¸æ˜¯ json æˆ– yamlï¼‰
- æŒ‡å®š `--format json`ï¼šç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿ç¨‹åºå¤„ç†
- æŒ‡å®š `--format md`ï¼šé€‚åˆç”Ÿæˆæ–‡æ¡£å’ŒæŠ¥å‘Š
- æŒ‡å®š `--format yaml`ï¼šäººç±»å¯è¯»çš„ç»“æ„åŒ–æ ¼å¼

## è¿›é˜¶ç”¨æ³•

### æ‰¹é‡å¤„ç†å›¾ç‰‡

```bash
#!/bin/bash
for img in images/*.jpg; do
  echo "Processing: $img"
  ./scripts/image_captioner.sh "$img" > "descriptions/$(basename $img .jpg).txt"
done
```

### ç”Ÿæˆ Markdown æŠ¥å‘Š

```bash
python src/main.py run image_captioner \
  --image photo.jpg \
  -i '{"question": "è¯·ç”Ÿæˆè¯¦ç»†çš„å›¾ç‰‡åˆ†ææŠ¥å‘Š"}' \
  --format md \
  -o report.md
```

### ä¸å…¶ä»–å·¥å…·ç»“åˆ

```bash
# 1. ç”Ÿæˆå›¾ç‰‡æè¿°
./scripts/image_captioner.sh photo.jpg > description.json

# 2. ä½¿ç”¨ jq æå–ç‰¹å®šå­—æ®µ
cat description.json | jq -r '.outputs.caption'
```

## ç›¸å…³æ–‡æ¡£

- [ä½¿ç”¨æŒ‡å—](../../docs/usage.md)
- [è®¾è®¡æ–‡æ¡£](../../docs/design.md)
